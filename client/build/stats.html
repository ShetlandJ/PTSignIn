<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Young Person</title>
  <script src="bundle.js"></script>
  <link rel="stylesheet" href="style.css">

</head>
<body>

  <div class="topnav">
    <button onClick="home()">Today</button>
    <button onClick=thisMonth()>This Month</button>
    <button>This Year</button>
    <button>All time</button>
  </div>

  <div id="visits">
    <h2 id="visits-today"></h2>
  </div>

  <script>

  var home = function() {

    const url = 'https://api.mlab.com/api/1/databases/signins/collections/signins?apiKey=Vp2I1nmC961_lV2whDojmmOuZzXb0S_o';

    var makeRequest = function(url, callback){
      var request = new XMLHttpRequest();
      request.open("GET", url);
      request.addEventListener("load", callback);
      request.send();
    }

    var requestComplete = function(){
      if (this.status !== 200) return;
      var jsonString = this.responseText;
      var myData = JSON.parse(jsonString);
      renderInfo(myData)

    }

    makeRequest(url, requestComplete)
  }


  var renderInfo = function(myData) {
    var today = new Date();
    var dd = today.getDate()
    var mm = today.getMonth()+1
    var yy = today.getYear()

    let counter = 0
    for (var visit of myData) {
      visitDate = new Date(visit.date)

      if (visitDate.getDate() === dd && visitDate.getMonth()+1 === mm && visitDate.getYear() === yy) {
        counter += 1
      }

      document.getElementById('visits-today').innerText = "Visits today: " + counter
    }
  }


  var thisMonth = function() {

    const url = 'https://api.mlab.com/api/1/databases/signins/collections/signins?apiKey=Vp2I1nmC961_lV2whDojmmOuZzXb0S_o';

    var makeRequest = function(url, callback){
      var request = new XMLHttpRequest();
      request.open("GET", url);
      request.addEventListener("load", callback);
      request.send();
    }

    var requestComplete = function(){
      if (this.status !== 200) return;
      var jsonString = this.responseText;
      var myData = JSON.parse(jsonString);
      renderMonth(myData)

    }

    makeRequest(url, requestComplete)
  }


  var renderMonth = function(myData) {
    var today = new Date();
    var dd = today.getDate()
    var mm = today.getMonth()+1
    var yy = today.getYear()

    let counter = 0
    for (var visit of myData) {
      visitDate = new Date(visit.date)

      if (visitDate.getMonth()+1 === mm && visitDate.getYear() === yy) {
        counter += 1
      }

      document.getElementById('visits-today').innerText = "Visits this month: " + counter
    }
  }


  window.addEventListener( 'load', home);
</script>

</body>
</html>
